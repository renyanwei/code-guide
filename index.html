---
layout: default
---


<div class="heading" id="toc">
  <h2>目录</h2>
</div>
<div class="section toc">
  <div class="col">
    <h4><a href="#base">基础</a></h4>
    <ul>
      <li><a href="#base-md5">MD5计算</a></li>
      <li><a href="#base-urlencrypt">URL加密/校验</a></li>
      <li><a href="#base-pnpk">PN和PK安全机制</a></li>
      <li><a href="#base-json">JSON序列化/反序列化</a></li>
    </ul>
  </div>
  <div class="col">
    <h4><a href="#log">日志</a></h4>
    <ul>
      <li><a href="#log-memo">概述</a></li>
      <li><a href="#log-error">错误（Error）日志</a></li>
      <li><a href="#log-warn">警告（Warn）日志</a></li>
      <li><a href="#log-info">信息（Info）日志</a></li>
    </ul>
  </div>
</div>


<div class="section" id="golden-rule">
  <div class="col">
    <h2>黄金定律</h2>
    <p>永远遵循同一套编码规范 -- 可以是这里列出的，也可以是你自己总结的。如果你发现本规范中有任何错误，一块为本规范添加或贡献内容。</p>
  </div>
  <div class="col">
    <blockquote>
      <p>不管有多少人共同参与同一项目，一定要确保每一行代码都像是同一个人编写的。</p>
    </blockquote>
  </div>
</div>



<div class="heading" id="base">
  <h2>基础</h2>
</div>

<div class="section" id="html-md5">
  <div class="col">
    <h3>MD5计算</h3>
      <p>目前C#内置的实现MD5计算方式有很多种，方式不同编码不同结果也不相同，因此我们统一规范采用MD5CryptoServiceProvider类进行计算，此方法已经被封装到Common中的MD5类Encrypt方法中。注意：判断MD5值是否相等应该忽略大小写。将要比较的两个MD5统一转成大写或小写形式再进行判断。</p>
  </div>
  <div class="col">
    {% highlight c# %}
using Common;
namespace Portal.Test
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine(MD5.Encrypt("original string"));
        }
    }
}	
	{% endhighlight %}
  </div>
</div>

<div class="section" id="base-urlencrypt">
  <div class="col">
    <h3>URL加密/校验</h3>
    <p>在子系统、不同系统之间如果决定采用HTTP进行数据通讯时，应该对HTTP的请求方参数处理，生成唯一指纹，HTTP的接收方则应该对指纹进行校验，校验通过则表示为正常合法的请求，反之则应该进行驳回处理，目前相关方法已经封装到Common中的SafeUrlUtility类中。注意，加密、校验依赖于PN和PK机制，加密和校验过程中会读取WEB.Config设置的PN和PK，具体PN和PK机制详见相关的说明。</p>
  </div>
  <div class="col">
    {% highlight c# %}
/*
 *接口请求方
 */
static void Main(string[] args)
{
    //生成含有唯一指纹的安全URL,会在QueryString附加sign和pn参数
    string safeRequestUrl = SafeUrlUtility.HashUrlCreate("http://www.httpinterface.com/api/demoapi", new
    {
        param1 = "str1",
        param2 = "str2",
        //更多参数
    });
    //开始请求，获取结果
    dynamic result = ApiClient.GET(safeRequestUrl);
    //根据result进行对应处理
}

/*
 *接口接收方
 */
public ActionResult demoapi(string pn, string param1, string param2)
{
    //根据pn查询数据库获取到对应的pk
    //string pk=GetPKforPN(pn);
    //校验请求是否合法
    bool issafe = SafeUrlUtility.HashUrlVerify(pk, Request);
    if (issafe)
    {
        //请求合法，执行其他业务逻辑
    }
    else
    {
        //请求不合法，驳回
    }
}
	{% endhighlight %}
  </div>
</div>

<div class="section" id="base-pnpk">
  <div class="col">
    <h3>PN和PK安全机制</h3>
    <p>在进行对对系统架构进行合理的拆解和封装形成各自独立的服务时势必会面临系统之间通过HTTP进行数据的互相访问的场景，特设置PN和PK机制来解决这个问题：</p>
	<ul>
	<li>
	PN：每个子系统的唯一标识，通常会在HTTP请求中明文传送，参与加密计算并附加在请求的QueryString参数中。
	</li>
	<li>
	PK：每个PN对应的加密密钥，通常存储在Web.Config中，参数加密计算但不会在各个子系统之间通过HTTP传递。
	</li>
	</ul>
	<p>
	每个系统拥有唯一的PN和PK，应该存储在系统根目录Web.Config的appSettings节点。所有系统的PN和PK存储在Tiantis数据库中App_SimplyInfo表。
	</p>
  </div>
  <div class="col">
    {% highlight xml %}
<appSettings>
  <!--其他配置信息-->
  <add key="pn" value="00000213"/>
  <add key="pk" value="3c51704a09844314a74ec5fbec7c7a34"/>
</appSettings>
	{% endhighlight %}
  </div>
</div>

<div class="section" id="base-json">
  <div class="col">
    <h3>JSON序列化/反序列化</h3>
    <p>处理JSON在每个系统中用的频率非常高，不光是WEB项目，还有各种类库，都会有这方面的事情要处理，所以在Common项目中统一引用了JSON.NET，而其他项目如果需要用JSON.NET，引用Common就好了。这样整个解决方案只会有一次引用，可以避免上述问题的发生，具体JSON操作封装在JsonHelper类中的SerializeObject方法和DeserializeObject方法。</p>
    
  </div>
  <div class="col">
    {% highlight c# %}
static void Main(string[] args)
{
    //JSON序列化
    string json = Common.JsonHelper.SerializeObject(new { });

    //JSON反序列化
    dynamic obj=Common.JsonHelper.DeserializeObject(json);
    //JSON反序列化，泛型支持
    Model model = Common.JsonHelper.DeserializeObject<Model>(json);
}	
	{% endhighlight %}
  </div>
</div>

<div class="heading" id="css">
  <h2>日志</h2>
</div>

<div class="section" id="css-syntax">
  <div class="col">
    <h3>Syntax</h3>
    <ul>
      <li>Use soft tabs with two spaces—they're the only way to guarantee code renders the same in any environment.</li>
      <li>When grouping selectors, keep individual selectors to a single line.</li>
      <li>Include one space before the opening brace of declaration blocks for legibility.</li>
      <li>Place closing braces of declaration blocks on a new line.</li>
      <li>Include one space after <code>:</code> for each declaration.</li>
      <li>Each declaration should appear on its own line for more accurate error reporting.</li>
      <li>End all declarations with a semi-colon. The last declaration's is optional, but your code is more error prone without it.</li>
      <li>Comma-separated property values should include a space after each comma (e.g., <code>box-shadow</code>).</li>
      <li>Don't include spaces after commas <em>within</em> <code>rgb()</code>, <code>rgba()</code>, <code>hsl()</code>, <code>hsla()</code>, or <code>rect()</code> values. This helps differentiate multiple color values (comma, no space) from multiple property values (comma with space).</li>
      <li>Don't prefix property values or color parameters with a leading zero (e.g., <code>.5</code> instead of <code>0.5</code> and <code>-.5px</code> instead of <code>-0.5px</code>).</li>
      <li>Lowercase all hex values, e.g., <code>#fff</code>. Lowercase letters are much easier to discern when scanning a document as they tend to have more unique shapes.</li>
      <li>Use shorthand hex values where available, e.g., <code>#fff</code> instead of <code>#ffffff</code>.</li>
      <li>Quote attribute values in selectors, e.g., <code>input[type="text"]</code>. <a href="http://mathiasbynens.be/notes/unquoted-attribute-values#css">They’re only optional in some cases</a>, and it’s a good practice for consistency.</li>
      <li>Avoid specifying units for zero values, e.g., <code>margin: 0;</code> instead of <code>margin: 0px;</code>.</li>
    </ul>
    <p>Questions on the terms used here? See the <a href="http://en.wikipedia.org/wiki/Cascading_Style_Sheets#Syntax">syntax section of the Cascading Style Sheets article</a> on Wikipedia.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/syntax.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-declaration-order">
  <div class="col">
    <h3>Declaration order</h3>
    <p>Related property declarations should be grouped together following the order:</p>
    <ol>
      <li>Positioning</li>
      <li>Box model</li>
      <li>Typographic</li>
      <li>Visual</li>
    </ol>
    <p>Positioning comes first because it can remove an element from the normal flow of the document and override box model related styles. The box model comes next as it dictates a component's dimensions and placement.</p>
    <p>Everything else takes place <em>inside</em> the component or without impacting the previous two sections, and thus they come last.</p>
    <p>For a complete list of properties and their order, please see <a href="http://twitter.github.com/recess">Recess</a>.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/declaration-order.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-import">
  <div class="col">
    <h3>Don't use <code>@import</code></h3>
    <p>Compared to <code>&lt;link&gt;</code>s, <code>@import</code> is slower, adds extra page requests, and can cause other unforeseen problems. Avoid them and instead opt for an alternate approach:</p>
    <ul>
      <li>Use multiple <code>&lt;link&gt;</code> elements</li>
      <li>Compile your CSS with a preprocessor like Sass or Less into a single file</li>
      <li>Concatenate your CSS files with features provided in Rails, Jekyll, and other environments</li>
    </ul>
    <p>For more information, <a href="http://www.stevesouders.com/blog/2009/04/09/dont-use-import/">read this article by Steve Souders</a>.</p>
  </div>
  <div class="col">
    {% highlight html %}{% include css/import.html %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-media-queries">
  <div class="col">
    <h3>Media query placement</h3>
    <p>Place media queries as close to their relevant rule sets whenever possible. Don't bundle them all in a separate stylesheet or at the end of the document. Doing so only makes it easier for folks to miss them in the future. Here's a typical setup.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/media-queries.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-prefixed-properties">
  <div class="col">
    <h3>Prefixed properties</h3>
    <p>When using vendor prefixed properties, indent each property such that the declaration's value lines up vertically for easy multi-line editing.</p>
    <p>In Textmate, use <strong>Text &rarr; Edit Each Line in Selection</strong> (&#8963;&#8984;A). In Sublime Text 2, use <strong>Selection &rarr; Add Previous Line</strong> (&#8963;&#8679;&uarr;) and <strong>Selection &rarr;  Add Next Line</strong> (&#8963;&#8679;&darr;).</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/prefixed-properties.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-single-declarations">
  <div class="col">
    <h3>Single declarations</h3>
    <p>In instances where a rule set includes <strong>only one declaration</strong>, consider removing line breaks for readability and faster editing. Any rule set with multiple declarations should be split to separate lines.</p>
    <p>The key factor here is error detection—e.g., a CSS validator stating you have a syntax error on Line 183. With a single declaration, there's no missing it. With multiple declarations, separate lines is a must for your sanity.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/single-declarations.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-shorthand">
  <div class="col">
    <h3>Shorthand notation</h3>
    <p>Strive to limit use of shorthand declarations to instances where you must explicitly set all the available values. Common overused shorthand properties include:</p>
    <ul>
      <li><code>padding</code></li>
      <li><code>margin</code></li>
      <li><code>font</code></li>
      <li><code>background</code></li>
      <li><code>border</code></li>
      <li><code>border-radius</code></li>
    </ul>
    <p>Often times we don't need to set all the values a shorthand property represents. For example, HTML headings only set top and bottom margin, so when necessary, only override those two values. Excessive use of shorthand properties often leads to sloppier code with unnecessary overrides and unintended side effects.</p>
    <p>The Mozilla Developer Network has a great article on <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Shorthand_properties">shorthand properties</a> for those unfamiliar with notation and behavior.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/shorthand.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-nesting">
  <div class="col">
    <h3>Nesting in Less and Sass</h3>
    <p>Avoid unnecessary nesting. Just because you can nest, doesn't mean you always should. Consider nesting only if you must scope styles to a parent and if there are multiple elements to be nested.</p>
    <p>Additional reading:</p>
    <ul>
      <li><a href="http://markdotto.com/2015/07/20/css-nesting/">Nesting in Sass and Less</a></li>
    </ul>
  </div>
  <div class="col">
    {% highlight scss %}{% include css/nesting.scss %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-operators">
  <div class="col">
    <h3>Operators in Less and Sass</h3>
    <p>For improved readability, wrap all math operations in parentheses with a single space between values, variables, and operators.</p>
  </div>
  <div class="col">
    {% highlight scss %}{% include css/operators.scss %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-comments">
  <div class="col">
    <h3>Comments</h3>
    <p>Code is written and maintained by people. Ensure your code is descriptive, well commented, and approachable by others. Great code comments convey context or purpose. Do not simply reiterate a component or class name.</p>
    <p>Be sure to write in complete sentences for larger comments and succinct phrases for general notes.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/comments.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-classes">
  <div class="col">
    <h3>Class names</h3>
    <ul>
      <li>Keep classes lowercase and use dashes (not underscores or camelCase). Dashes serve as natural breaks in related class (e.g., <code>.btn</code> and <code>.btn-danger</code>).</li>
      <li>Avoid excessive and arbitrary shorthand notation. <code>.btn</code> is useful for <em>button</em>, but <code>.s</code> doesn't mean anything.</li>
      <li>Keep classes as short and succinct as possible.</li>
      <li>Use meaningful names; use structural or purposeful names over presentational.</li>
      <li>Prefix classes based on the closest parent or base class.</li>
      <li>Use <code>.js-*</code> classes to denote behavior (as opposed to style), but keep these classes out of your CSS.</li>
    </ul>
    <p>It's also useful to apply many of these same rules when creating Sass and Less variable names.</p>
  </div>
  <div class="col">
    {% highlight css %}{% include css/class-names.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-selectors">
  <div class="col">
    <h3>Selectors</h3>
    <ul>
      <li>Use classes over generic element tag for optimum rendering performance.</li>
      <li>Avoid using several attribute selectors (e.g., <code>[class^="..."]</code>) on commonly occuring components. Browser performance is known to be impacted by these.</li>
      <li>Keep selectors short and strive to limit the number of elements in each selector to three.</li>
      <li>Scope classes to the closest parent <strong>only</strong> when necessary (e.g., when not using prefixed classes).</li>
    </ul>
    <p>Additional reading:</p>
    <ul>
      <li><a href="http://markdotto.com/2012/02/16/scope-css-classes-with-prefixes/">Scope CSS classes with prefixes</a></li>
      <li><a href="http://markdotto.com/2012/03/02/stop-the-cascade/">Stop the cascade</a></li>
    </ul>
  </div>
  <div class="col">
    {% highlight css %}{% include css/selectors.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-organization">
  <div class="col">
    <h3>Organization</h3>
    <ul>
      <li>Organize sections of code by component.</li>
      <li>Develop a consistent commenting hierarchy.</li>
      <li>Use consistent white space to your advantage when separating sections of code for scanning larger documents.</li>
      <li>When using multiple CSS files, break them down by component instead of page. Pages can be rearranged and components moved.</li>
    </ul>
  </div>
  <div class="col">
    {% highlight css %}{% include css/organization-comments.css %}{% endhighlight %}
  </div>
</div>

<div class="section" id="css-editor-prefs">
  <div class="col">
    <h3>Editor preferences</h3>
    <p>Set your editor to the following settings to avoid common code inconsistencies and dirty diffs:</p>
    <ul>
      <li>Use soft-tabs set to two spaces.</li>
      <li>Trim trailing white space on save.</li>
      <li>Set encoding to UTF-8.</li>
      <li>Add new line at end of files.</li>
    </ul>
    <p>Consider documenting and applying these preferences to your project's <code>.editorconfig</code> file. For an example, see <a href="https://github.com/twbs/bootstrap/blob/master/.editorconfig">the one in Bootstrap</a>. Learn more <a href="http://editorconfig.org">about EditorConfig</a>.</p>
  </div>
</div>
